(function(_){var n=[];var t={init:function(t){return this.each(function(){var i=this;var r=_(i).data("cbrepeat");if(r){return}r={};r.options=typeof t!="undefined"?t:{};r.defaults=_.fn.cbrepeat.defaults;r.settings=_.extend(true,{},r.defaults,r.options);r.element=_(i);if(r.settings.useData){_.each(r.defaults,function(e,t){if(e!="init"&&e!="useData"){var a=r.element.data("cbrepeat"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof a!="undefined"){r.settings[e]=a}else{a=r.element.data("cbrepeat"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof a!="undefined"){r.settings[e]=a}}}})}if(!r.settings.min){r.settings.min=1}r.element.triggerHandler("cbrepeat.init.before",[r]);if(!r.settings.init){return}if(r.settings.sortable){var e=r.element.find(".cbRepeatRow").filter(function(){return _(this).closest(".cbRepeat").is(r.element)}).first();r.element.sortable({placeholder:e.attr("class")+" cbRepeatRowPlaceholder",forcePlaceholderSize:true,cursor:"move",items:".cbRepeatRow",containment:"parent",animated:true,stop:function(e,t){var a=[];r.element.find(".cbRepeatRow").filter(function(){return _(this).closest(".cbRepeat").is(r.element)}).find("input:checked").each(function(){a.push(_(this))});d.call(i,r);_.each(a,function(e,t){t.prop("checked",true)});r.element.triggerHandler("cbrepeat.move",[r,e,t])},tolerance:"pointer",handle:".cbRepeatRowMove",opacity:.5})}r.addHandler=function(e){e.preventDefault();var t=r.element.find(".cbRepeatRowAddCount").filter(function(){return _(this).closest(".cbRepeat").is(r.element)});var a=1;if(t.length&&t.val()>0){a=t.val()}if(r.settings.limit&&a>r.settings.limit){a=r.settings.limit;if(t.length){t.val(a)}}s.call(i,a)};if(r.settings.add){r.element.find(".cbRepeatRowAdd").filter(function(){return _(this).closest(".cbRepeat").is(r.element)}).on("click.cbrepeat",r.addHandler)}r.removeHandler=function(e){e.preventDefault();var t=_(this).closest(".cbRepeatRow");a.call(i,t)};if(r.settings.remove){r.element.find(".cbRepeatRowRemove").filter(function(){return _(this).closest(".cbRepeat").is(r.element)}).on("click.cbrepeat",r.removeHandler)}d.call(i,r);r.element.on("remove.cbrepeat destroy.cbrepeat",function(){r.element.cbrepeat("destroy")});r.element.on("rebind.cbrepeat",function(){r.element.cbrepeat("rebind")});r.element.on("modified.cbrepeat",function(e,t,a,i){if(a!=i){r.element.cbrepeat("rebind")}});r.element.bind("cloned.cbrepeat",function(){_(this).off(".cbrepeat");_(this).removeData("cbrepeat");_(this).removeData("uiSortable");_(this).removeData("ui-sortable");var e=_(this).find(".cbRepeatRow").first().parent();_(this).find(".cbRepeatRowAdd").filter(function(){return _(this).closest(".cbRepeat").is(e)}).off("click.cbrepeat",r.addHandler);_(this).find(".cbRepeatRowRemove").filter(function(){return _(this).closest(".cbRepeat").is(e)}).off("click.cbrepeat",r.removeHandler);_(this).cbrepeat(r.options)});r.element.triggerHandler("cbrepeat.init.after",[r]);r.element.data("cbrepeat",r);n.push(r)})},add:function(e){if(!e){e=1}s.call(this,e);return this},remove:function(e){a.call(this,e);return this},update:function(){var e=_(this).data("cbrepeat");if(!e){return this}d.call(this,e);return this},reset:function(){var e=_(this).data("cbrepeat");if(!e){return this}var t=e.element.find(".cbRepeatRow:not(:first)").filter(function(){return _(this).closest(".cbRepeat").is(e.element)});t.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");t.remove();d.call(this,e);return this},rebind:function(){var e=_(this).data("cbrepeat");if(!e){return this}e.element.cbrepeat("cbrepeat");e.element.cbrepeat(e.options);return this},destroy:function(){var a=_(this).data("cbrepeat");if(!a){return this}if(a.settings.sortable){a.element.sortable("destroy");a.element.removeData("uiSortable");a.element.removeData("ui-sortable")}a.element.find(".cbRepeatRowAdd").filter(function(){return _(this).closest(".cbRepeat").is(a.element)}).off("click.cbrepeat",a.addHandler);a.element.find(".cbRepeatRowRemove").filter(function(){return _(this).closest(".cbRepeat").is(a.element)}).off("click.cbrepeat",a.removeHandler);a.element.off(".cbrepeat");_.each(n,function(e,t){if(t.element==a.element){n.splice(e,1);return false}return true});a.element.removeData("cbrepeat");a.element.triggerHandler("cbrepeat.destroyed",[a]);return this},instances:function(){return n}};function s(e){var t=_(this).data("cbrepeat");if(!t){return false}var a=t.element.find(".cbRepeatRow").filter(function(){return _(this).closest(".cbRepeat").is(t.element)});if(t.settings.max&&a.length>=t.settings.max){return false}var i=a.last();var r=[];i.find("input:checked").each(function(){r.push(_(this))});var n=[];var s=[];for(var l=0;l<e;++l){var c=i.find("*");if(t.settings.ignore){c=c.not(t.settings.ignore)}c.each(function(){if(_(this).triggerHandler("cloning")){n.push(_(this))}});var o=i.clone(true);o.insertAfter(i);var f=o.find(".cbRepeat");if(t.settings.ignore){f=f.not(t.settings.ignore)}f.each(function(){var e=this;var t=_(this).find(".cbRepeatRow:not(:first)").filter(function(){return _(this).closest(".cbRepeat").is(_(e))});t.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");t.remove()});c=o.find("*");if(t.settings.ignore){c=c.not(t.settings.ignore)}c.each(function(){if(_(this).is("input,select,textarea")&&!_(this).hasClass("cbRepeatNoReset")&&!_(this).closest(".cbRepeatNoReset").length){var e=_(this).attr("type");var t=_(this).data("cbrepeat-default");if(typeof t!="undefined"){t=_.trim(t)}else{t=null}if(e=="checkbox"||e=="radio"){if(t){if(e=="checkbox"&&t.indexOf("|*|")!=-1){if(t.split("|*|").indexOf(_(this).val())!=-1){_(this).prop("checked",true)}else{_(this).prop("checked",false)}}else{if(_(this).val()==t){_(this).prop("checked",true)}else{_(this).prop("checked",false)}}}else{if(e=="radio"&&_(this).siblings('input[type="radio"]').length+1==2&&_(this).val()==0){_(this).prop("checked",true)}else{_(this).prop("checked",false)}}if(e=="radio"&&_(this).siblings('input[type="radio"]').length+1==2){if(_(this).val()==0){_(this).next("label").addClass("btn-danger")}else{_(this).next("label").addClass("btn-success")}}if(e=="radio"){_(this).next("label").removeClass("active")}}else{if(t){if(_(this).is("select[multiple]")){t=t.split("|*|")}_(this).val(t)}else{_(this).val("");if(_(this).is("select")){if(!_(this).children('option[value=""]:first').length){_(this).val(_(this).children('option[value!=""]:first').val())}}}}}s.push(_(this))})}d.call(this,t);_.each(r,function(e,t){t.prop("checked",true)});_.each(n,function(e,t){t.triggerHandler("rebind")});_.each(s,function(e,t){t.triggerHandler("cloned")});t.element.triggerHandler("cbrepeat.add",[t]);return true}function a(e){var t=_(this).data("cbrepeat");if(!t){return false}var a=t.element.find(".cbRepeatRow").filter(function(){return _(this).closest(".cbRepeat").is(t.element)});if(t.settings.min&&a.length<=t.settings.min){return false}if(!e){e=a.last()}e.find('.cbTabs,.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");e.find(".cbRepeat").off("remove.cbrepeat");e.remove();d.call(this,t);t.element.triggerHandler("cbrepeat.remove",[t]);return true}function d(R){var a=R.element.find(".cbRepeatRow").filter(function(){return _(this).closest(".cbRepeat").is(R.element)});var e=a.find(".cbRepeatRowRemove").filter(function(){return _(this).closest(".cbRepeatRow").is(a)});var t=e.closest(".cbRepeatRowIncrement").filter(function(){return _(this).closest(".cbRepeatRow").is(a)});if(a.length>R.settings.min){e.removeClass("hidden");if(t.length){t.removeClass("hidden")}if(R.settings.sortable){R.element.sortable("enable")}}else{e.addClass("hidden");if(t.length){t.addClass("hidden")}if(R.settings.sortable){R.element.sortable("disable")}}if(R.settings.max){var i=a.find(".cbRepeatRowAdd").filter(function(){return _(this).closest(".cbRepeatRow").is(a)});var r=null;if(!i.length){i=R.element.find(".cbRepeatRowAdd").filter(function(){return _(this).closest(".cbRepeat").is(R.element)});r=i.closest(".cbRepeatRowIncrement").filter(function(){return _(this).closest(".cbRepeat").is(R.element)})}else{r=i.closest(".cbRepeatRowIncrement").filter(function(){return _(this).closest(".cbRepeatRow").is(a)})}if(a.length>=R.settings.max){i.addClass("hidden");if(r.length){r.addClass("hidden")}}else{i.removeClass("hidden");if(r.length){r.removeClass("hidden")}}}if(!R.settings.sortable||a.length<=1){a.find(".cbRepeatRowSort").filter(function(){return _(this).closest(".cbRepeatRow").is(a)}).addClass("hidden")}else if(a.length>1){a.find(".cbRepeatRowSort").filter(function(){return _(this).closest(".cbRepeatRow").is(a)}).removeClass("hidden")}a.each(function(v){var e=_(this).find("*[id],*[for],*[name],*[data-cbrepeat-fallback-id],*[data-cbrepeat-fallback-for],*[data-cbrepeat-fallback-name]").filter(function(){return _(this).closest(".cbRepeatRow").is(a)});if(R.settings.ignore){e=e.not(R.settings.ignore)}var t=_(this).find(".cbRepeatRowIndex").filter(function(){return _(this).closest(".cbRepeatRow").is(a)});if(t.length){if(t.is("input")){t.html(v+1)}else{t.html(v+1)}}e.each(function(){if(_(this).attr("id")||_(this).attr("data-cbrepeat-fallback-id")){var e="id";if(!_(this).attr("id")){e="data-cbrepeat-fallback-id"}var t=_(this).attr(e);if(!_(this).data("orgId")){_(this).data("orgId",_(this).attr(e))}_(this).attr(e,_(this).attr(e).replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+v+"$3"));var a=_(this).attr(e);_(this).triggerHandler("modified",[t,a,v]);var r=t.replace("cbfr_","").replace("cbfv_","").replace(/__[a-zA-Z0-9]+$/g,"");var n=a.replace("cbfr_","").replace("cbfv_","").replace(/__[a-zA-Z0-9]+$/g,"");if(r!==n){var i=_(this).closest(".cbRepeatRow").find('*[id*="'+r+'"],*[id*="'+r.replace(/_{2,}/g,"__")+'"],*[data-cbrepeat-fallback-id*="'+r+'"],*[id*="'+r.replace(/_{2,}/g,"__")+'"]');if(R.settings.ignore){i=i.not(R.settings.ignore)}i.each(function(){if(_(this).attr("id")){var a=_(this).attr("id");if(!_(this).data("orgId")){_(this).data("orgId",_(this).attr("id"))}_(this).attr("id",_(this).attr("id").replace(r,n).replace(r.replace(/_{2,}/g,"__"),n.replace(/_{2,}/g,"__")));var e=_(this).attr("id");if(typeof cbHideFields!="undefined"){var i=[];_.each(cbHideFields,function(e,t){if(t[0]==a||t[1]==a){i.push(t)}});_.each(i,function(e,t){var a=[];a[0]=t[0].replace(r,n).replace(r.replace(/_{2,}/g,"__"),n.replace(/_{2,}/g,"__"));a[1]=t[1].replace(r,n).replace(r.replace(/_{2,}/g,"__"),n.replace(/_{2,}/g,"__"));a[2]=t[2];a[3]=t[3];a[4]=[];_.each(t[4],function(e,t){a[4].push(t.replace(r,n).replace(r.replace(/_{2,}/g,"__"),n.replace(/_{2,}/g,"__")))});a[5]=[];_.each(t[5],function(e,t){a[5].push(t.replace(r,n).replace(r.replace(/_{2,}/g,"__"),n.replace(/_{2,}/g,"__")))});var i=false;_.each(cbHideFields,function(e,t){if(t[0]==a[0]&&t[1]==a[1]&&t[2]==a[2]&&t[3]==a[3]){i=true}});if(!i){cbHideFields.push(a)}})}_(this).triggerHandler("modified",[a,e,v])}if(_(this).attr("data-cbrepeat-fallback-id")){_(this).attr("data-cbrepeat-fallback-id",_(this).attr("data-cbrepeat-fallback-id").replace(r,n).replace(r.replace(/_{2,}/g,"__"),n.replace(/_{2,}/g,"__")))}})}}if(_(this).attr("for")||_(this).attr("data-cbrepeat-fallback-for")){var s="for";if(!_(this).attr("for")){s="data-cbrepeat-fallback-for"}var l=_(this).attr(s);var c=_(this).attr(s).replace(/\[[a-zA-Z0-9]+\]$/g,"").replace(/__[a-zA-Z0-9]+$/g,"");if(!_(this).data("orgFor")){_(this).data("orgFor",_(this).attr(s))}_(this).attr(s,_(this).attr(s).replace(/^(.*)(\[\d+\])(\[\w+\])$/g,"$1["+v+"]$3"));_(this).attr(s,_(this).attr(s).replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+v+"$3"));var o=_(this).attr(s);_(this).triggerHandler("modified-for",[l,o,v]);var f=_(this).attr(s).replace(/\[[a-zA-Z0-9]+\]$/g,"").replace(/__[a-zA-Z0-9]+$/g,"");if(c!==f){var d=_(this).closest(".cbRepeatRow").find('*[for*="'+c+'"],*[data-cbrepeat-fallback-for*="'+c+'"]');if(R.settings.ignore){d=d.not(R.settings.ignore)}d.each(function(){if(_(this).attr("for")){var e=_(this).attr("for");if(!_(this).data("orgFor")){_(this).data("orgFor",_(this).attr("for"))}_(this).attr("for",_(this).attr("for").replace(c,f));var t=_(this).attr("for");_(this).triggerHandler("modified-for",[e,t,v])}if(_(this).attr("data-cbrepeat-fallback-for")){_(this).attr("data-cbrepeat-fallback-for",_(this).attr("data-cbrepeat-fallback-for").replace(c,f))}})}}if(_(this).attr("name")||_(this).attr("data-cbrepeat-fallback-name")){var h="name";if(!_(this).attr("name")){h="data-cbrepeat-fallback-name"}var p=_(this).attr(h);var b=_(this).attr(h).replace(/\[[a-zA-Z0-9]+\]$/g,"").replace(/__[a-zA-Z0-9]+$/g,"");if(!_(this).data("orgName")){_(this).data("orgName",_(this).attr(h))}_(this).attr(h,_(this).attr(h).replace(/^(.*)(\[\d+\])(\[\w+\])$/g,"$1["+v+"]$3"));_(this).attr(h,_(this).attr(h).replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+v+"$3"));var u=_(this).attr(h);_(this).triggerHandler("modified-name",[p,u,v]);var m=_(this).attr(h).replace(/\[[a-zA-Z0-9]+\]$/g,"").replace(/__[a-zA-Z0-9]+$/g,"");if(b!==m){var g=_(this).closest(".cbRepeatRow").find('*[name*="'+b+'"],*[data-cbrepeat-fallback-name*="'+b+'"]');if(R.settings.ignore){g=g.not(R.settings.ignore)}g.each(function(){if(_(this).attr("name")){var e=_(this).attr("name");if(!_(this).data("orgName")){_(this).data("orgName",_(this).attr("name"))}_(this).attr("name",_(this).attr("name").replace(b,m));var t=_(this).attr("name");_(this).triggerHandler("modified-name",[e,t,v])}if(_(this).attr("data-cbrepeat-fallback-name")){_(this).attr("data-cbrepeat-fallback-name",_(this).attr("data-cbrepeat-fallback-name").replace(b,m))}})}}})});if(typeof cbHideFields!="undefined"){var n=[];_.each(cbHideFields,function(e,t){if(!_("#"+t[0]).length){n.push(t)}});_.each(n,function(e,t){cbHideFields.splice(cbHideFields.indexOf(t),1)})}if(typeof cbInitFields!="undefined"){cbInitFields()}if(a.length==R.settings.min){R.element.addClass("cbRepeatMin")}else if(a.length==R.settings.max){R.element.addClass("cbRepeatMax")}else{R.element.removeClass("cbRepeatMin cbRepeatMax")}R.element.triggerHandler("cbrepeat.updated",[R])}_.fn.cbrepeat=function(e){if(t[e]){return t[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return t.init.apply(this,arguments)}return this};_.fn.cbrepeat.defaults={init:true,useData:true,sortable:true,ignore:null,add:true,remove:true,min:1,max:0,limit:25}})(jQuery);